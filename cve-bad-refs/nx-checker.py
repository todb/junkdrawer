import csv

# Read the list of unregistered domains from nxdomains.txt into a set
unregistered_domains = set()
with open('nxdomains.txt', 'r') as nxdomains_file:
    for line in nxdomains_file:
        unregistered_domains.add(line.strip())

# Create a list to store the matching entries
matching_entries = []

# Read the CSV file and check for matching entries
with open('cves_with_dead_domains.csv', 'r') as csv_file:
    reader = csv.reader(csv_file)
    header = next(reader)  # Skip the header row
    for row in reader:
        cve_id, referenced_domain, domain_parts = row
        # Check if any registered domain matches the end of the referenced domain
        for registered_domain in unregistered_domains:
            if referenced_domain.endswith(registered_domain):
                matching_entries.append(row)

# Write the matching entries to a new CSV file
with open('hijackable_cves.csv', 'w', newline='') as output_file:
    writer = csv.writer(output_file)
    writer.writerow(header)
    writer.writerows(matching_entries)
