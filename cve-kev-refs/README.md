# Goals

Archiving CVE references, ideally, will preserve vulnerability data for future security researchers,
both professional and hobbiest, for effectively all time. We're currently in a phase of pretty serious
[enshittification](https://en.wiktionary.org/wiki/enshittification) on the internet right now, so having
more than one copy of sometimes key vuln data seems important. We want to be able to:

* Archive all CVE references from all time, includig the past
* Archive "important" CVE references
  - KEV seems important
* Archive new CVE references as they come in
* Have some mapping between original and archived references
  - It should be easily usable by end users, per CVE ID
  - The archive reference should be canonical since it was "true" when referenced.
  - The archive should be generated on the spot when CVE IDs are published
* Archives should be distributed
  - archive.org seems trustworthy, but...
  - Torrents seem to be a good format for enabling distribution
  - Torrents are hard to deeplink into
* Archives should be easily replaced
  - If archive.org ever does go down, it should be easy to rebuild and redirect
* Maintainers of this whole archive scheme should be easily replacable

With that, here are some notes on what I've done so far.

# Archiving KEV references

While all CVEs are special, KEV references are extra special.

## Getting all KEV references

Thanks to our pals at NVD, this is super easy:

```bash
curl --location 'https://services.nvd.nist.gov/rest/json/cves/2.0?hasKev'| 
  jq '.vulnerabilities[].cve | 
  {"id": .id, "refs": [.references[].url]}' > 
  kev-refs.json
```

There are currently 4611 unique KEV references, according to
`cat kev-refs.json| jq '.refs[]' | sort | uniq | wc -l` (as of today).

This seems tractable.

## ArchiveBox

ArchiveBox is pretty easy to use, and gettable at https://archivebox.io/#quickstart. Of course, just
running my own ArchiveBox instance doesn't really solve the archiving problem. What I'd like to do
is collect a simple snapshot of mid- to low-quality, tag it with a CVE ID, and then start releasing
those on torrents once a month or so. In the meantime, we /could/ run our own ArchiveBox instance,
and use ArchiveBox's inherent tagging functionality to tag each archive with the relevant CVE ID.

If you want access to Tod's install of ArchiveBox, ask him for a user/pass
to [Armitage](http://armitage.hugesuccess.org:8000) (Note the http-ness, we should help them
get an out-of-the-box HTTPS listener going for security's sake.)

### Samples

I tested out the "Get it all" functionality with five references, mostly to see how much disk space
these references are going to take, and also to test how reliable the archiving is.

<img width="1139" alt="image" src="https://user-images.githubusercontent.com/24144/235985820-518a2931-7940-4eca-85e4-2f5da37b6cc8.png">

Of the five (Oracle, Microsoft, Twitter, Apple, and ZDI), only the ZDI reference seemed to run into
trouble with archiving (and we'll want to look into why that is).

The sizes are a little big when you get all the different outputs, but the chromium singlefile snapshot
seems reasonable at the largest being 1.4mb:

<img width="1172" alt="image" src="https://user-images.githubusercontent.com/24144/235987724-50332758-bf6f-41d0-8168-d642727f2771.png">

## ArchiveTeam

There's a group of mad archivists out there, [ArchiveTeam](https://wiki.archiveteam.org/), who work with,
but are distinct from, Archive.org. They hang out on IRC, are opinionated, and probably could help with
this whole thing. I'll talk to them.

# Archiving exercises: ArchiveBox

So let's see what works and what doesn't

## Just archive.org links

When adding all those 4611 URLs to Archivebox and ticking just the "archive.org" archive format, that finishes basically immediately.
Mostly all of these links were already archived by someone, so that's pretty handy and good to know.

## Singlepage.html

Churning through this now (on May 8, 2023) so I'll report back when that's done and see what broke.

## Automating new CVE ID references

Coming soon?




